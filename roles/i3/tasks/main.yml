---
- name: Install i3-gaps
  become: true
  become_user: root
  pacman:
    name:
      - i3-gaps

- name: Ensure directory exists
  file:
    path: /home/{{ user.name }}/.config/i3/config_temp
    state: directory
    recurse: yes

- name: Copy scripts directory
  copy:
    src: scripts
    dest: /home/{{ user.name }}/.config/i3/

- name: Copy wallpapers
  copy:
      src: wallpapers/{{ pc }}/
      dest: /home/{{ user.name }}/.config/i3/wallpapers

- name: Copy base config
  copy:
    src: base
    dest: /home/{{ user.name }}/.config/i3/config_temp/base
  register: base_res

- name: Copy specific config
  copy:
    src: specific_{{ pc }}
    dest: /home/{{ user.name }}/.config/i3/config_temp/specific
  register: spec_res

- name: Merge configs
  assemble:
      src: /home/{{ user.name }}/.config/i3/config_temp
      dest: /home/{{ user.name }}/.config/i3/config
      delimiter: "#################################################################"

- name: Copy specific status config
  copy:
    src: specific_status_{{ pc }}
    dest: /home/{{ user.name }}/.config/i3/i3status.conf
  when: pc != "x230" and pc != "g751"

- name: Copy specific status config (i3status-rc)
  copy:
    src: specific_status_rc_{{ pc }}
    dest: /home/{{ user.name }}/.config/i3/status_rc.yoml
  when: pc == "x230" or pc == "g751"

- name: Copy specific xinitrc
  copy:
    src: specific_xinitrc_{{ pc }}
    dest: /home/{{ user.name }}/.xinitrc

- name: NOPASSWD sudo for g751 i3 script
  become: true
  become_user: root
  lineinfile:
    dest: /etc/sudoers.d/13-g751-scripts
    line: "{{ user.name }} ALL=(root) NOPASSWD: /home/{{ user.name }}/.config/i3/scripts/g751/*
"
    create: yes
    validate: 'visudo -cf %s'
  when: pc == "g751"

- name: Set script as executable
  file: dest=/home/{{ user.name }}/.config/i3/scripts/g751/change_brightness mode=a+x
  when: pc == "g751"
